# Wiki Loading & Summarization Fixes - Walkthrough

## Changes Made

### 1. Fixed Recursive Wiki Page Loading

#### [wiki_loader.py](file:///Users/tsumacpro/ScottyLabs/bark/src/bark/context/wiki_loader.py)

Changed `glob("*.md")` → `rglob("*.md")` to recursively find all markdown files in subdirectories.

```diff
-for md_file in wiki_path.glob("*.md"):
+for md_file in wiki_path.rglob("*.md"):
```

---

### 2. Summarization-Based Embeddings

Instead of embedding raw document chunks (expensive), chunks are now summarized first using a cheap LLM.

#### [config.py](file:///Users/tsumacpro/ScottyLabs/bark/src/bark/core/config.py)

Added `summarization_model` configuration:

```python
summarization_model: str = "google/gemini-2.0-flash-lite-001"
```

#### [NEW] [summarizer.py](file:///Users/tsumacpro/ScottyLabs/bark/src/bark/context/summarizer.py)

New module that:
- Uses cheap LLM to create concise, searchable summaries
- Falls back to truncated content on errors

#### [engine.py](file:///Users/tsumacpro/ScottyLabs/bark/src/bark/context/engine.py)

Updated [refresh()](file:///Users/tsumacpro/ScottyLabs/bark/src/bark/context/engine.py#52-102) flow:

```
chunks → summarize(content) → embed(summary) → store
```

---

## Verification

- ✅ Python syntax validated for all modified files
- Manual testing recommended: Run `refresh_context` via Bark and check logs for summarization output
